<!DOCTYPE html>
<html>
  <head>
    <title>Commenting App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/style.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
  </head>
  <body data-bind="event: { mouseup: tabDragUp, mousemove: bandDrag}"> 
	  <div class="container">

      <div id="cm-header" class="jumbotron">
   
      </div> <!-- Close jumbotron --> 

      <div class="col-xs-12" id="cm-wrapper">
<!--           <h3> Comments </h3> 

          <div class="col-xs-8" >
             
             <div class='cm-commentBox'> 
                <div class='cm-commentText' data-postid="" data-source="">
                  <b>Username</b>
                  <span class='cm-boxMenu cm-reply'> 
                    Reply
                  </span><br /><span > Content of the discussion</span>
                </div>
              </div>
          </div>
          <div class="col-xs-4"> 
            <input type="text" class="form-control" placeholder="Filter">
            <hr class="soften" /> 
           <textarea type="text" class="cm-box" placeholder="Add comment" > </textarea> 
            <button class="btn btn-success btn-sm cm-boxSubmit btn-lg"> Add Comment</button> 

          </div> -->

              
 
      </div>


     
    <div class="col-xs-12 footer">
       <hr class="soften" />
        <div class="text-center"> Built with Mithril. </div>
    </div>

    </div> <!-- Close Container  -->




    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://code.jquery.com/jquery.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="../js/bootstrap.min.js"></script>
    <script src="mithril.min.js"></script>
    <script type="text/javascript">
	 
      // Define the module
      var comment = {};  

      // Info Model that contains general information about the module  
      comment.Info = function(data){
        this.title = m.prop(data.title);
        this.description = m.prop(data.description);  
        this.script = m.prop("mithril"); 
        this.loggedUser = m.prop(data.user) 
      }; 

      comment.List = m.prop([]);
      m.request({method: "GET", url: "../data.json"}).then(comment.List).then(comment.loadComments);


      comment.Comment = function(data){
        this.id = m.prop(data.id); 
        this.content = m.prop(data.content); 
        this.user = m.prop(data.user); 
      }; 




      // Main Controller that adds a comment
      comment.controller = function() {
        this.content = m.prop(""); 
        this.add = function() {
            if (this.content()) {
                comments.List.push(new comment.Comment({content: this.content()}));
                this.content("");
                console.log(this.list);
            }
        }.bind(this);

      }



      // VIEWS
      comment.ShowCommentsView = function(comments) {
        return m("div#cm-showComments", [
                comments.list.map(function(comment, index){
                    return   m("ul", [
                        m("li", {value : comment.content()} )
                      ])
                })                
   
              ])    
      }; 

      comment.ShowFormView = function(){
        return  m("div#cm-addComment", [
                  m("textarea.cm-box", {onchange: m.withAttr("value", makeComment.content), value: makeComment.content()}), 
                m("button.btn.btn-info.cm-boxSubmit", {onclick: makeComment.add}, "Add"),            
              ]) 
      }

      comment.headerView = function(info){
        return  m("div", [
                m('h2#cm-title.', info.title()),
                m("p#cm-desc.lead", info.description()) 
          ])
                }

      var makeComment = new comment.controller();
 

      // Render Headers
      // Add some info to the module
      var MyComment = new comment.Info({title:"Commenting module", description: "Using Mithril framework",  user : "Caner" }); 
      m.render(document.getElementById("cm-header"), comment.headerView(MyComment)); 
      m.render(document.getElementById("cm-wrapper"), comment.ShowFormView()); 
      m.render(document.getElementById("cm-wrapper"), comment.ShowCommentsView(comments.List)); 


	    
    </script>
  </body>
</html>