var through = require('through2');
var gutil = require('gulp-util');
var PluginError = gutil.PluginError;

const PLUGIN_NAME = 'jsontree-generator';

module.exports =  function outputJSON (totalLevels){

    var stream = through.obj(function(file, enc, callback) {

        // Dummy text taken from http://www.lipsum.com/
        var stringBlock = "lorem ipsum dolor sit amet, consectetur adipiscing elit etiam vitae erat vel quam lobortis sagittis vestibulum porttitor lorem augue donec non quam non massa tempor tempor in tristique tortor nunc ac erat nulla suspendisse vel euismod dui pellentesque quis risus at sapien consequat varius nullam id magna auctor, vulputate sem nec, rutrum metus ut mattis nunc ut tristique vehicula vestibulum pulvinar viverra dolor in scelerisque fusce faucibus justo dolor, sed mollis magna consequat sed duis quis odio mollis, dapibus lorem id, consequat ligula lorem ipsum dolor sit amet, consectetur adipiscing elit mauris imperdiet non mi vel volutpat sed egestas faucibus libero quis facilisis sed placerat magna in erat egestas aliquam ut eu dui erat nulla sed porttitor massa, non accumsan odio nam vel pharetra augue, eu dictum neque phasellus congue feugiat diam, eu semper leo aliquam in nam accumsan velit sapien, non pellentesque ligula eleifend ac etiam lobortis eget arcu non cursus nullam commodo vel nisl vestibulum pellentesque morbi iaculis, nunc id bibendum viverra, enim urna mattis neque, quis accumsan tellus massa a tortor quisque sollicitudin turpis consequat euismod sollicitudin donec fermentum molestie erat ut vestibulum etiam congue gravida est, vel pulvinar urna nunc eleifend suscipit adipiscing donec in auctor lorem, eu fermentum nisi donec molestie diam enim cras nec nibh et diam accumsan ultrices non eu est nullam rutrum mauris tellus, ut semper lacus hendrerit id integer euismod risus orci, ultricies elementum diam dapibus quis suspendisse posuere bibendum neque, eu vulputate dui consequat vitae duis eu varius velit etiam ultrices risus eget ligula semper, a laoreet urna fringilla praesent at adipiscing nunc vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; aliquam ligula risus, pellentesque nec neque sed, tempus consequat lectus nunc eu neque turpis praesent posuere commodo lectus vitae pharetra maecenas cursus bibendum elementum in vitae semper eros sed eget massa diam morbi enim sem, consectetur eget ornare vel, vehicula sit amet felis sed ullamcorper dolor id ante dignissim, at placerat nulla consectetur sed sit amet cursus lacus suspendisse non nunc ac tortor porttitor elementum nulla non lobortis massa, ac volutpat metus mauris ultrices vestibulum enim sit amet auctor aenean adipiscing dolor quam, sit amet tincidunt nibh tristique a cras posuere ullamcorper odio phasellus sed nunc sit amet urna placerat pretium ut a mauris ut vitae ipsum sed enim venenatis pellentesque sit amet vel lorem sed vitae arcu eu dolor rutrum pharetra fusce condimentum ac sapien eu pellentesque sed mi purus, mattis et mauris quis, pulvinar dapibus risus fusce ligula sem, cursus ut odio vel, elementum porta lorem sed aliquet, velit ut dignissim ullamcorper, est diam egestas enim, et ultrices ante sem sit amet purus duis vestibulum erat id urna aliquam ornare fusce pellentesque libero leo integer mi tellus, venenatis a sem ut, iaculis scelerisque neque nullam aliquet odio ac mi posuere, a feugiat justo facilisis duis luctus semper lacinia cras velit libero, suscipit vel pharetra non, viverra at nisl suspendisse sit amet ligula augue suspendisse feugiat dictum lorem ac tincidunt maecenas est nunc, sodales non vestibulum eget, semper nec eros nullam ac est risus curabitur fermentum, felis in fermentum rhoncus, metus neque faucibus tortor, sed eleifend felis libero et orci sed ut velit pretium sapien pretium facilisis sed magna ligula, hendrerit non orci consequat, ullamcorper cursus ligula sed elit erat, varius tristique odio vitae, congue sagittis dolor proin iaculis tincidunt feugiat curabitur eget dapibus tellus vivamus id dui placerat ipsum pulvinar elementum ac sed nisl maecenas consectetur accumsan ante, non porttitor nunc integer in sem id enim sodales cursus suspendisse molestie risus at mollis posuere sed nunc leo, posuere nec convallis at, fermentum sed ipsum sed id vehicula sapien etiam non semper nibh, lobortis eleifend massa donec eget mauris mattis, ullamcorper dui in, molestie dui aenean pretium elit ac eleifend dictum sed ullamcorper laoreet turpis ac semper nullam luctus pellentesque purus ut mattis aliquam vestibulum dolor in orci condimentum, vitae rutrum arcu aliquet aliquam quis lacinia tellus sed massa odio, ornare in cursus nec, gravida at nibh nam facilisis arcu non imperdiet placerat pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas pellentesque massa ante, blandit id pellentesque non, malesuada a mauris morbi ornare sem interdum lacus mattis, quis elementum risus fringilla phasellus facilisis lorem nisi, auctor luctus enim vestibulum ac aenean placerat mauris quis arcu vulputate bibendum proin et enim non nibh fringilla pulvinar id sit amet velit aenean id urna ac tortor dignissim ullamcorper eget eget nisi ut auctor turpis nec risus rhoncus, eu mattis lorem scelerisque in aliquet dolor eget arcu pharetra iaculis maecenas sit amet ipsum vel leo sagittis fringilla tincidunt id magna phasellus ultrices ligula turpis, sed sodales nibh suscipit quis morbi dictum, elit eget molestie fermentum, eros leo facilisis mi, vitae sollicitudin velit sem sed nulla nullam tincidunt purus at ligula pretium sollicitudin quisque et magna vel sapien tempor posuere ut sit amet erat integer nunc lacus, hendrerit vitae enim ut, pulvinar ullamcorper leo proin bibendum eget lectus at lobortis proin facilisis auctor orci, sit amet pretium mi imperdiet a interdum et malesuada fames ac ante ipsum primis in faucibus aliquam massa elit, tristique vitae dui vel, convallis euismod mauris vivamus vitae quam molestie, bibendum ante et, hendrerit leo fusce ut eros et neque egestas aliquam ac nec velit etiam ut libero lacinia, blandit augue id, pellentesque erat integer aliquam arcu et elit pharetra, in rhoncus eros vulputate";
        var nameBlock = "Hatsue Tsuda,Ryan Brady,Najma Martinsson,Eleanor Richardson,Ryuuji Nagasawa,Donald Cole,Lukaš Piško,Winta Ali,Meryem Reijntjes,Geirfinnur Friðgeirsson,Noel Cervántez,Svend Josefsen,Jabel Cepeda,Marcus Hallen,Sólbjört Sigfúsdóttir,Lei Tsai,Johanna Frey,Virginio Pichardo,Milly Simpson,Taija Niskavaara,Harue Nakahara,Thijm Litjens,Calum Paterson,Sævar Svansson,Barbara Marchand,Ane Løvstrøm,Tewelde Osman,Alaor Saldana,Sasara Shirai,Ranko Ćosić,Pierino Piazza,Össur Guðgeirsson,Marziyet Khadzhiyev,Bloeme Tjon,Kurzhan Kishiev,Hanna Paasivirta,Sally Graham,Joyce Teasley,Lavinia Costa,Rahel Sheshy,Erick Santos,Hanne Geisler,Pauline Lennert,Claudia Symes,Yoshiharu Kawahara,William Kent,Kyuuto Honma,Futsum Samuel,György Gyenes,Nicholas Cooper,Šeila Nedveš,Otilija Jelečević,Franka de,Kam,Andreja Jukić,Tomi Saariaho,Sanna Tikkanen,Metran Merino,Časlav Živković,Sirazhdi Masaev,Tereza Janáčová,Jolanta Pawłowska,Sarah Papst,Vilma Sandberg,Klara Zielinska,Liliana Lettiere,Natasza Walczak,Regine Davidsen,Brandi Denn,Zuzana Kopková,Henry Landry,Freydís Skarphéðinsdóttir,Mathias Aachen,Gustava Longo,Sari Kozawa,Cai Hsu,Alastair Reilly,Fethawi Negassi,Izabella Lindström,Beata Lund,Reona Iwasaki,Lubab Cham,Percy Hákonarson,Youhei Horiuchi,Ulpu Pokka,Nikola Bajlec,Ors Baranyi,Ovlur Umkhayev,Justin Martin,Belda Tremblay,Petronio Colombo,Gakuto Fukushima,Cong Yin,Abdullah Asmara,Maya Thompson,Kate Hunter,Kauê Martins,Ririko Takashima,Senior Givry,Alida Trevisan,Bozena Shubina,Thomas Coleman,Leonardo Jamieson,Timirbulat Godina,Marina Schaefer,Nikolaj Frederiksen,Xue,Fang Yuan,Merle Desroches,Desirée Serrano,Jeanne Agapova,Alacoque Bisson,Marcella Li,Fonti,Uberto Li,Fonti,Þorvaldur Loftsson,Kadyn Brown,Adhemar León,Mathias Bumgarner,Allaug Bjune,Sako Masuda,Encarna Miranda,Hugo Kottila,Timothy Mathis,Kimberly Nordbø,Rodion Alexeeva,Birning Stiansen,Maciej Moore,Ivalu Enoksen,Patryk Stevenson,Jimmy Lundqvist,Karen Tran,Bisrat Tesfay,Wilmer Jakobsson,Aino Kaitala,Tahvo Leminen,Arnaude Alexandre,Vinicius Lima,Marveille Gendron,Annemarije van,Emden,Ákos Sándor,Lincoln Pigot,Salóme Bryndísardóttir,Julian Almeida,Magomed Rushisvili,Lars Rosing,George Clemens,Elfa Ívarsdóttir,Anton Mogensen,Salomea Michalska,Guðgeir Kolbeinsson,Hideo Takahasi,Takuho Amano,Kuba Wysocki,Diana Dahlberg,Krisztofer Sági,Svend Berthelsen,Jeff Amos,Elżbieta Woźniak,Felizia Lindholm,Daniela Ćosić,Tena Klarić,Hester den,Ridder,Walid Nyberg,Olympics Efremova,'Adilah Abboud,Helena Dujmović,Pamela Sahernik,Charmaine Bonami,Marc Forbes,Venla Hyytiä,Petros Selam,Makda Afwerki,Alexander Ravn,Kirsten Løvstrøm,Miriam Crawford,Ryan Moriarty,Mayhew Laliberté,Niels Lange,Alicia Teigland,Makoto Nakagawa,Lovro Knežević,Yi Chin,André Araujo,Tewolde Eyob,Laia Bahena,Tamás Schmit,Himzo Remich,Josías Frías,Fred Dahl,Vidar Høiberg,Gojslav Lukić,Razija Pesičer,Lisa Robidoux,Riikka Lintilä,Orsolya Forgáts,Gradasso Favreau,Jón Bergsveinsson,Meeke van,der,Lugt,Polla Ryzaev,Stefanía Baldursdóttir,Max Walker,Rolleiv Lindberg,Marie Marková,Gunna Jóakimsdóttir,Mina Petersson,Madihah Negassi,David Michell,Wu Niu,Vivienne Chenard,Kaoru Nakamoto,Luděk Beneš,Kjølv Nordstrøm,Astrid Møller,Wakil Morcos,Irina Balashova,Anastasia Fredriksson,Bikatu Dratchev,Phoebe Wilkinson,Freddie Lundqvist,Durgali Inarkaevich,Medina Holcapfel,Dominika Kelemen,Gai Miyazaki,Vanda Hoffman,Benjamin Glover,Ludmila Kovářová,Sebastian McGregor,Chung Hsü,Morgan Dale,Bojana Mikulić,Huan,Yue He,Barry Thompson,Richard Poe,Gustav Lundin,Carl Repin,Renan Correia,Ken Pečjak,Szilveszter Halász,Ilona Kornilova,Camilla Giordano,Fesahaye Osman,Eriskhan Batukayev,Gjertinus Enge,Siniša Mađar,Slavko Barić,Ulderico Boni,Dorofei Anisimov,Kristian Kristiansen,Evdokim Alexandrov,Per Brandt,Anastasio Lorenzo,Adam Lauritsen,Berkant Dursun,Hollie Potter,Anne Jensen,Gabriel Samuel,Atiya Tannous,Bonacata Sabbatini,Evdokim Voronov,Tobias Lyberth,Katarina Horváth,Kjeld Wisløff,Yin Holwerda,Tomoki Niiya,Suray Arce,Kvetoslava Kadlecová,Aubin Grandbois,Peter Suorsa,Yvonne Kluge,Syed McIntyre,Morten Bech,Heloise Gladu,Ljupka Orter,Ena Horvat,Hamid Idris,Sveinn Arnþórsson,Zorka Martinović,Albano Palermo,Arsenio Genovese,Kadyn Gray,Judithe Møller,Emil Kruse,Tara Göransson,Zofia Pawlak,Marthijs Koolman,Caio Correia,Timur Kiss,Erik Koch,Stanislaus Prokhorova,Brianna Sturdee,Li,Mei Pan,Henrik Enoksen,Maslin Vincent,Husam,al,Din Nazari,Laurentino Soto,Tamara Kishiev,Mónica Granados,Marigona Rakitovac,Maximilian Dickson,Shamil Khouri,Audry Beelen,Walid Amari,Jan Přibyl,Sarika Rácz,Sander Bech,Zita Fenyvesi,Julitta Rutkowska,Xenophon Zhirov,Semhar Biniam,Reinholdt Grannes,Yong Lo,Declan Roerink,Roberto Ivarsson,Lucyna Król,Markku Paloranta,Ilijana Badalli,Bikatu Korgay,Luisa Milani,Alphonsine Benoit,Emma Dubinina,Caresse Ducharme,Gisela Terán,Jeppe Lund,Alphonsine Labrie,Sarah Eiffel,Márkó Takách,Shu,Fang Tung,Daniele Valen,Erlendur Ludvigsson,Eyob Fethawi,Božena,Natalija Fištrovič,Jensine Nielsen,Aydin van,Silfhout,Max Vaverka,Vratislav Fojtů,Kedar Basara,Åsveig Norum,On Sung,Lidya Gabriel,Vicuska Sultis,Yuan Ch'ien,Jussi Laukka,Mauro Greco,Badri Botros,Tobias Sørensen,Mario Daecher,Wiert Houkes,Jonathan Holst,Elvio Štabej,Feaven Daniel,Ludmiła Wojciechowska,Dennis Richter,Clothilde Lacroix,Isabelle Silva,Klaus Schuhmacher,Jaroslava Balounová,Chinouk Slabbers,Hessa Isa,Blaženka Vujaković,Ralf Beich,Fesahaye Adonay,Berdinus Rosenvinge,Harbin Paimboeuf,Karlotta Joly,Abeba Ermias,Lechosława Wieczorek,Ljubinko Štajnbaher,Tahlia Ayers,Rion Yoshimura,Louise Hansen,Ísfold Tryggvadóttir,Seniha Kontič,Aminah Dagher,Isni Novinec,Zekö Vince,Souichi Shimizu,Erick Lima,Mireille Lapierre,Marzhan Korgay,Jean Washington,Petros Tesfalem,Ju Lü,Phillipp Muench,Nikolina Berg,Bacchus Rolón,Fredo Dimović,Věra Plzáková,Szebasztián Lörinc,Maria Pihlava,Kondrat Zhirov,Ramzi Morcos,Hamid Tesfay,Shishay Osman,Camilla Koltsova,Praskovya Komarova,Forbes Hill,Rushdi Sarraf,Zoltan Moličnik,Nancy Burman,Daniel Chenard,Larisa Kishiev,Sigurþór Samúelsson,Michael Kozlov,Micheal Mackey,Kristiane Langøy,Melissa Fuller,Zargan Arsanukayev,Drew Reid,Roderick Gibson,Vitoria Lima,Eshan Maclean,Halgerd Soleng,Šemsija Pridgar,Emeterio Najera,Alisha Sinclair,Mikayla Puddy,Salikh Akhtakhanov,Izolda Sawicka,Tobias Sandgreen,Anna Foerster,Ali Tesfalem,Fredek Fenyvessy,Robert Knápek,Meggi Mekicar,Teruyoshi Chiba,Timo Tiainen,Taemi Katagiri,Kidane Abraham,Urszula Woźniak,Lea Jager,Kenneth Craig,Zhi Ch'en,Line Madsen,Hallsteinn Yngvason,Yasin Wasem,Edward Brown,Jindřich Kraus,Isami Aoyama,Silje Abrahamsson,Vigar Heggedal,Vladlen Seleznyov,Mhret Mebrahtu,Eilert Høiland,Angelika Friedman,Judas Rendón,Grímur Frímannsson,Yong Yuan,Hiroyo Kudo,Nazia van,Nuland,Boris Horvatinčić,Jaakko Autio,Obed Quintana,Matija Petrović,Luwam Girmay,Brigitte Trommler,Cornelius Høiseth,Alfred Hansen,Vala Skúladóttir,Martin Andreasen,Asmart Godina,Aldo Milano,Michaela Moore,Aidan Bale,Lei Lu,Michael Gregor,Alma Gregersen,Tewelde Fikru,Carl-Johan Sundberg,Roelfina Ardon,Hu Wan,Yul Chien,Denes Erôs,Nadia Sundström,Jernejka Dvoraček,Taymaskha Musliyevich,Matthew Robson,Joel Oxley,Henny de,Bondt,Naïm Treffers,Gebre Filmon,Christian Bumgarner";

        // Names taken from Fake Name Generator http://www.fakenamegenerator.com/license.php
        var stringArray = stringBlock.split(" ").join(",").split(".").join(",").toLowerCase().split(",");
        var nameArray = nameBlock.split(",");

        /*
             Generate random numbers, define top limit with "top" parameter
        */
        var randomNumber = function(top){
            var top = top || 100000;
            return Math.floor(Math.random()*(top+1));
        }

        /*
            Generate random strings from string block list, define number of strings with "number" parameter
         */
        var randomString = function(number){
            var number = number || 10;
            var output = "";
            for(var i = 0; i < number; i++){
                var randomPlace = randomNumber(stringArray.length);
                output += stringArray[randomPlace] + " "
            }
            return output;
        }

        /*
             Connect strings into different string types, define "type" and "number" of strings
             type options = name, title, sentence
         */
        var styledString = function(type, number){
            var output = "";
            var end = " ";
            for(var i = 0; i < number; i++){
                var word = randomString(1);
                switch(type) {
                    case "name":
                        word = word.charAt(0).toUpperCase() + word.slice(1);
                        break;
                    case "title":
                        word = word.charAt(0).toUpperCase() + word.slice(1);
                        break;
                    case "sentence":
                        if(i==0){
                            word = word.charAt(0).toUpperCase() + word.slice(1);
                        }
                        if(i == number-1){
                            end = ".";
                        };
                        break;
                }
                output += word + end;
            }
            return output;
        }

        /*
            Get a random person name from name array
         */
        var randomPerson = function(){
            return nameArray[randomNumber(nameArray.length)];
        }

        /*
            Return a random boolean
         */
        var randomBoolean = function(){
            var num = randomNumber(1);
            if(num < 1){
                return false;
            } else {
                return true;
            }
        }

        /*
            Return a random option from those defined, (mimicking multiple choice), "options" is a string with comma separated items
         */
        var randomOption = function(options){
            var list = options.split(",");
            var choice = list[randomNumber(list.length)];
            return choice;
        }

        /*
            Return an array of certain "type" and "length"
            Types are = mixed (default), string only, number only, boolean only
         */
        var randomArray = function(type, length){
            var randomArray = [];
            var num = 0;
            for (var i = 0; i < length; i++){
                switch(type) {
                    case "string":
                        num = 1;
                        break;
                    case "number":
                        num = 2;
                        break;
                    case "boolean":
                        num = 0
                        break;
                    default :
                        num = randomNumber(2);
                }
                switch(num) {
                    case 2:
                        randomArray.push(randomNumber())
                        break;
                    case 1:
                        randomArray.push(randomString())
                        break;
                    default:
                        randomArray.push(randomBoolean())
                }
            }
            return randomArray;
        }

        /*
            Construct your json object
         */
        var obj = function (){
            return { 	"name" : randomPerson(),
                "desc" : styledString("sentence", 14),
                "title" : styledString("title", 5),
                "age": randomNumber(60),
                "skills" : randomOption("js, css, html, python"),
                "status" : randomBoolean(),
                "stuff" : randomArray("mixed", randomNumber(8)),
                "date" : new Date,
                "children" : []
            }
        }

        /*
            Build a json object going down "level" number of levels.
         */
        var iterID = 1; // Something like a unique id
        var buildJSON = function redo (level){
            var childarray = [];
            var iteration = randomNumber(3);
            for(var i  = 0; i < iteration; i++){
                var thisObj = new obj();
                thisObj.id = iterID;
                thisObj.level = totalLevels-level+1;
                iterID++;
                if( level > 0) {
                    thisObj.children = redo (level-1);
                }
                childarray.push( thisObj);
            }
            return childarray;
        }
        var output = buildJSON(totalLevels);

        var outputBuffer = new Buffer(JSON.stringify(output));
        if (file.isNull()) {
            // Do nothing if no contents
            throw new PluginError(PLUGIN_NAME, "The file is empty or there was no file. ");
        }
        if (file.isBuffer()) {
            file.contents = Buffer.concat([outputBuffer]);
        }
        if (file.isStream()) {
            throw new PluginError(PLUGIN_NAME, "Stream isn't supported yet. ");
        }
        this.push(file);
        return callback();
    });
    return stream;
}